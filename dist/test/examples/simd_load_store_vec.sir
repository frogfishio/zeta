unit simd_load_store_vec target host +simd:v1

type V4i32 = vec(i32, 4)
type buf4 = array(i32, 4)

fn main() -> i32 public
  let p: ptr = alloca(buf4) +align=16 +zero=true

  ;; v = [1,2,3,4]
  let v0: V4i32 = vec.splat(1:i32) as V4i32
  let v1: V4i32 = vec.replace(v0, 1:i32, 2:i32) as V4i32
  let v2: V4i32 = vec.replace(v1, 2:i32, 3:i32) as V4i32
  let v: V4i32 = vec.replace(v2, 3:i32, 4:i32) as V4i32

  store.vec(p, v) +align=16
  let w: V4i32 = load.vec(p) +align=16 as V4i32

  ;; return lane 2 (3)
  return vec.extract(w, 2:i32) as i32
end

